# Data Model: Frontend Authentication and Dashboard

**Feature**: 003-frontend-auth-dashboard
**Date**: 2026-01-04
**Phase**: 1 - Design & Contracts

---

## Overview

This document defines the data model for the frontend application, including entities, their attributes, relationships, and validation rules. The frontend acts as a consumer of the existing FastAPI backend, so this model represents the TypeScript types and interface definitions used to interact with the backend API.

---

## Entities

### User

**Description**: Represents an authenticated user in the system. The User entity is managed by Better Auth and used for authentication and session management.

**Attributes**:

| Attribute | Type | Description | Validation | Backend Mapping |
|-----------|------|-------------|------------|-------------------|
| `id` | `UUID` | Unique identifier for the user | `users.id` |
| `email` | `string` | User's email address (validated format) | `users.email` |
| `name` | `string \| null` | User's display name | `users.name` |
| `token` | `string` | JWT authentication token (not stored in backend) | Generated by Better Auth |
| `createdAt` | `string` (ISO 8601) | When the user account was created | `users.created_at` |
| `updatedAt` | `string` (ISO 8601) | Last time the user was updated | `users.updated_at` |

**Relationships**:
- **User has-many Tasks**: One user can own multiple tasks
- **Better Auth Session**: User has an active session managed by Better Auth

**TypeScript Interface**:

```typescript
// types/user.ts
export interface User {
  id: string
  email: string
  name: string | null
  createdAt: string
  updatedAt: string
}

export interface UserSession {
  user: User | null
  token: string | null
  isAuthenticated: boolean
}
```

---

### Task

**Description**: Represents a work item that a user wants to track. Tasks are owned by a single user and cannot be accessed by other users.

**Attributes**:

| Attribute | Type | Description | Validation | Backend Mapping |
|-----------|------|-------------|------------|-------------------|
| `id` | `UUID` | Unique identifier for the task | `tasks.id` |
| `userId` | `UUID` | ID of the user who owns this task | `tasks.user_id` |
| `title` | `string` | Task title (required, max 500 chars) | `tasks.title` |
| `description` | `string \| null` | Detailed description (optional, unlimited text) | `tasks.description` |
| `status` | `"Pending" \| "Completed"` | Current state of the task | `tasks.status` |
| `createdAt` | `string` (ISO 8601) | When the task was created | `tasks.created_at` |
| `completedAt` | `string \| null` (ISO 8601) | When the task was marked complete | `tasks.completed_at` |
| `updatedAt` | `string` (ISO 8601) | Last time the task was modified | `tasks.updated_at` |

**Relationships**:
- **Task belongs-to User**: Each task is owned by exactly one user
- **User has-many Tasks**: One user can own multiple tasks

**TypeScript Interface**:

```typescript
// types/task.ts
export type TaskStatus = "Pending" | "Completed"

export interface Task {
  id: string
  userId: string
  title: string
  description: string | null
  status: TaskStatus
  createdAt: string
  completedAt: string | null
  updatedAt: string
}
```

---

## Validation Rules

### User Validation

| Rule | Description | Frontend Enforcement |
|------|-------------|---------------------|
| Email format | Must be valid email address | HTML5 email input validation + Regex pattern |
| Email required | Email is required for signup | Input `required` attribute |
| Password required | Password is required for signup | Input `required` attribute |
| Password complexity | Minimum 8 characters (backend enforces more) | Show hint if < 8 chars |
| Name required | Display name is optional for signup | Optional field |

### Task Validation

| Rule | Description | Frontend Enforcement |
|------|-------------|---------------------|
| Title required | Task title must not be empty | Input `required` attribute + form validation |
| Title length | Maximum 500 characters | `maxLength` attribute + character count display |
| Status values | Must be "Pending" or "Completed" | TypeScript type constraint + dropdown/radio selection |
| ID format | Must be valid UUID string | TypeScript type constraint |

---

## State Transitions

### Task Status Lifecycle

```
                    ┌─────────────┐
                    │   Created   │
                    └──────┬──────┘
                           │
                  ┌──────────▼──────────┐
                  │                     │
            ┌─────▼─────┐     │
            │   Pending   │     │
            └───┬───────┘     │
                  │              │
         ┌────────┼─────────▼────┐
         │        │            │
   ┌─────▼────┐   │    ┌─────▼────┐
   │ Completed │   │    │  Deleted   │
   └────────────┘   │    └────────────┘
         │            │
         └────────────┘
```

**Transition Rules**:
1. **Created → Pending**: All tasks are created with status "Pending" by default
2. **Pending → Completed**: User can mark pending task as completed (adds `completedAt` timestamp)
3. **Completed → Pending**: User can revert completed task to pending (removes `completedAt` timestamp)
4. **Any Status → Deleted**: User can delete tasks in any state

**Transitions NOT Allowed**:
- Direct creation as "Completed" (must start as "Pending")
- Deletion with state change (deletion is terminal)

---

## API Request/Response Models

### User Authentication

**Signup Request**:
```typescript
export interface SignupRequest {
  email: string
  password: string
  name?: string
}
```

**Signin Request**:
```typescript
export interface SigninRequest {
  email: string
  password: string
}
```

**Authentication Response**:
```typescript
export interface AuthResponse {
  user: User
  token: string
}
```

### Task Operations

**Create Task Request**:
```typescript
export interface CreateTaskRequest {
  title: string
  description?: string
}
```

**Update Task Request**:
```typescript
export interface UpdateTaskRequest {
  title?: string
  description?: string
  status?: TaskStatus
}
```

**Complete Task Response**:
```typescript
export interface CompleteTaskResponse {
  task: Task
  message: string
}
```

---

## Client-Side State

### UI State (React Context)

```typescript
// types/ui.ts
export type TaskFilter = "All" | "Pending" | "Completed"

export type ModalType = "create" | "edit" | "delete" | null

export interface UIState {
  // Modal state
  modalOpen: boolean
  modalType: ModalType
  selectedTask: Task | null

  // Filter state
  activeFilter: TaskFilter

  // Form state
  formData: Partial<Task>
}
```

### Server State (React Query Keys)

```typescript
// Query keys for caching and invalidation
export const queryKeys = {
  tasks: (userId: string) => ["tasks", userId] as const,
  task: (taskId: string) => ["task", taskId] as const,
  user: () => ["user"] as const,
}
```

---

## Data Flow

### Authentication Flow

```
┌─────────────┐     ┌─────────────┐     ┌──────────────┐
│   User      │─────▶│   Better     │─────▶│   Backend    │
│   Browser   │     │   Auth       │     │   FastAPI     │
└─────────────┘     │   Frontend   │     │              │
                    │             │     │              │
                    │   Issues    │◀────│  Validates    │
                    │   JWT        │     │  Credentials   │
                    │             │     │              │
                    │             │     └─────┬───────┘
                    │             │           │
                    │   Stores     │   │   Returns
                    │   token      │   │   user data + JWT
                    │   in         │   │
                    │   cookies     │   │
                    │             │     │
                    └──────┬──────┘
                           │
                    ┌────────▼────────┐
                    │  All requests   │
                    │  include JWT     │
                    │  in headers      │
                    └─────────────────┘
```

### Task CRUD Flow

```
┌─────────────┐     ┌──────────────┐     ┌──────────────┐
│   User      │─────▶│   Dashboard    │─────▶│   API          │
│   Browser   │     │   UI          │     │   Backend      │
└─────────────┘     └──────────────┘     └──────────────┘
                           │                      │
                           │                      │
                ┌──────────┼──────────────────────┼────────────┐
                │          │                      │            │
     ┌────────▼────┐   │          ┌────────▼─────┐  │
     │  Create Task │   │          │  Edit Task    │  │
     │   Update Task │   │          │  Delete Task   │  │
     └──────────────┘   │          └──────────────┘  │
                           │                      │
                    ┌────────┼──────────────────────┼────────┐
                    │        │                      │        │
          ┌─────────▼────────┐       │        ┌─────────▼────┐│
          │  React Query Cache │       │        │  React Query ││
          │  (Optimistic Updates)│       │        │  (Invalidation) ││
          └──────────────────────┘       │        └────────────────┘│
                                          │                       │
                                          │    ┌────────────────┼────────┐
                                          │    │                │        │
                                          │    │   UI Updates  │   Backend │
                                          │    │   (Instant)     │   Response│
                                          │    └────────────────┘   │          │
                                          │                       └──────────┘
```

---

## Type Safety

### TypeScript Configuration

```typescript
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "lib": ["DOM", "DOM.Iterable"],
    "jsx": "preserve",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "allowJs": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "isolatedModules": true,
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"]
    },
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx"],
  "exclude": ["node_modules"]
}
```

---

## Summary

This data model provides:
- Clear entity definitions with attributes and relationships
- Validation rules enforced at both frontend and backend
- Type-safe interfaces for API communication
- State management strategy separating UI and server state
- Well-defined data flows for authentication and task operations

The frontend data model aligns with the existing backend schema defined in the constitution, ensuring type safety and data consistency across the full-stack application.
